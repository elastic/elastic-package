# Custom Kibana Configuration

This document explains how to add custom configuration to Kibana when using elastic-package.

## Overview

You can provide additional Kibana configuration that will be appended to the base configuration generated by elastic-package. This allows you to:

- Override default settings
- Add custom plugins configuration
- Set up custom security settings
- Configure additional features

**Note**: For frequently-used configuration options, consider requesting first-level support in elastic-package rather than using custom configuration.

## Setup

1. Create your custom configuration file:
   ```bash
   # Create ~/.elastic-package/profiles/default/kibana.dev.yml
   touch ~/.elastic-package/profiles/default/kibana.dev.yml
   ```

2. Add your custom configuration:
   ```yaml
   # Example custom configuration
   logging.loggers:
     - name: plugins.security
       level: debug
   
   server.customResponseHeaders:
     X-Custom-Header: "MyValue"
   
   xpack.security.enabled: true
   ```

## Warning Message

When elastic-package detects a `kibana.dev.yml` file, it will display a warning message:
```
WARN: Custom Kibana configuration detected at /path/to/kibana.dev.yml - this may affect Kibana behavior
```

This warning helps you remember that custom configuration is active, which can be useful when troubleshooting Kibana issues.

## Configuration Precedence

1. Base elastic-package configuration (from template)
2. Your custom configuration (appended)

Since YAML allows duplicate keys and Kibana processes them in order, your custom settings will override base settings with the same key.

## Examples

### Enable Debug Logging
```yaml
logging.loggers:
  - name: root
    level: debug
  - name: plugins.fleet
    level: trace
```

### Custom Security Settings
```yaml
xpack.security.session.idleTimeout: "8h"
xpack.security.session.lifespan: "24h"
xpack.security.authc.providers:
  basic.basic1:
    order: 0
```

### Development Features
```yaml
server.rewriteBasePath: false
server.dev.basePathProxyTarget: 3000

# Enable experimental features
xpack.fleet.enableExperimental:
  - customIntegrations
  - agentTamperProtectionEnabled
```

### Custom UI Settings
```yaml
uiSettings:
  overrides:
    "theme:darkMode": true
    "dateFormat": "YYYY-MM-DD HH:mm:ss.SSS"
    "discover:sampleSize": 1000
```

## Troubleshooting

### Configuration Not Applied
- Verify the `kibana.dev.yml` file exists in your profile directory
- Check that the YAML syntax is valid
- Ensure the file is in the correct location: `~/.elastic-package/profiles/{profile_name}/kibana.dev.yml`

### Kibana Startup Issues
- Validate your custom configuration against Kibana documentation
- Start with minimal changes and add complexity gradually
- Check Kibana logs for configuration validation errors
- Remember that custom configuration may affect Kibana behavior (see warning message)

## Profile-Specific Configurations

You can have different custom configurations for different profiles:

```bash
# Development profile with debug settings
~/.elastic-package/profiles/development/kibana.dev.yml

# Production profile with optimized settings  
~/.elastic-package/profiles/production/kibana.dev.yml
```

Custom configuration is automatically detected and applied for each profile when the `kibana.dev.yml` file exists.

## Best Practices

1. **Start Simple**: Begin with basic configuration changes and add complexity gradually
2. **Use Comments**: Document your custom configurations for future reference
3. **Test Changes**: Verify that Kibana starts successfully after configuration changes
4. **Backup Configurations**: Keep copies of working configurations before making changes
5. **Consider First-Level Support**: For frequently-used options, request official elastic-package support instead of using custom configuration

## Limitations

- Custom configuration is appended to the base configuration (not merged at the YAML structure level)
- Some Kibana settings may require specific ordering or dependencies
- Custom configuration may affect Kibana behavior and troubleshooting

## Related Documentation

- [Kibana Configuration Settings](https://www.elastic.co/guide/en/kibana/current/settings.html)
- [elastic-package Profiles](../README.md#profiles)
- [Stack Configuration](../README.md#stack-configuration)
